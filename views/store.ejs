<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title><%= vendor.store_name %> - Ecowsco Market</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .cart-count {
    animation: bounce 0.3s ease;
  }
  @keyframes bounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
  }

  /* Smooth scroll for sidebar */
  #cartItems::-webkit-scrollbar {
    width: 6px;
  }
  #cartItems::-webkit-scrollbar-thumb {
    background-color: rgba(156, 163, 175, 0.5);
    border-radius: 9999px;
  }
</style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen pb-20">

  <!-- Header -->
  <div class="bg-white shadow-md mb-8">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 py-6 flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4">
      <div class="w-full sm:w-auto">
        <h1 class="text-2xl sm:text-3xl font-bold text-gray-800"><%= vendor.store_name %></h1>
        <p class="text-gray-600 mt-1 text-sm sm:text-base"><%= vendor.description || 'Welcome to our store' %></p>
      </div>
      <% if(vendor.whatsapp){ %>
        <a href="<%= vendor.whatsapp %>" target="_blank"
          class="w-full sm:w-auto text-center inline-flex items-center justify-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-5 py-3 rounded-lg hover:from-green-600 hover:to-emerald-700 transition font-semibold shadow-lg">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884"/>
          </svg>
          Contact on WhatsApp
        </a>
      <% } %>
    </div>
  </div>

  <!-- Products -->
  <div class="max-w-7xl mx-auto px-4 sm:px-6 pb-8">
    <% if(products.length === 0){ %>
      <div class="bg-white rounded-2xl shadow-xl p-10 sm:p-12 text-center">
        <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
        </svg>
        <p class="text-gray-500 text-lg">No products available at the moment</p>
      </div>
    <% } else { %>
      <div class="grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        <% products.forEach(p => { %>
          <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition overflow-hidden flex flex-col">
            <div class="relative h-48 sm:h-56">
              <img src="<%= p.image %>" alt="<%= p.name %>" class="w-full h-full object-cover">
            </div>
            <div class="p-4 sm:p-5 flex-1 flex flex-col">
              <h3 class="font-bold text-lg sm:text-xl text-gray-800 mb-2"><%= p.name %></h3>
              <p class="text-2xl font-bold text-green-600 mb-3">â‚µ<%= p.price %></p>
              <p class="text-sm text-gray-600 mb-4 line-clamp-2"><%= p.description || 'No description available' %></p>
              <button onclick="addToCart('<%= p.id %>', '<%= p.name %>', <%= p.price %>)"
                class="mt-auto w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition font-semibold shadow-lg">
                Add to Cart
              </button>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </div>

  <!-- Floating Cart Button -->
  <div id="cartButton" class="fixed bottom-5 right-5 z-50">
    <button onclick="toggleCart()" class="relative bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 rounded-full shadow-2xl hover:from-green-600 hover:to-emerald-700 transition">
      ðŸ›’
      <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center cart-count">0</span>
    </button>
  </div>

  <!-- Cart Sidebar -->
  <div id="cartSidebar" class="fixed top-0 right-0 h-full w-full sm:w-96 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50">
    <div class="h-full flex flex-col">
      <div class="p-6 border-b flex justify-between items-center bg-gradient-to-r from-blue-500 to-blue-600 text-white">
        <h3 class="text-xl sm:text-2xl font-bold">Your Cart</h3>
        <button onclick="toggleCart()" class="text-white hover:text-gray-200">
          âœ–
        </button>
      </div>
      <div id="cartItems" class="flex-1 overflow-y-auto p-6">
        <p class="text-gray-500 text-center">Your cart is empty</p>
      </div>
      <div class="p-6 border-t bg-gray-50">
        <div class="mb-4 flex justify-between text-lg font-semibold">
          <span>Total:</span>
          <span id="cartTotal" class="text-green-600">â‚µ0.00</span>
        </div>
        <button onclick="checkoutWhatsApp()" id="checkoutBtn" disabled
          class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-4 rounded-lg font-bold hover:from-green-600 hover:to-emerald-700 transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
          Checkout via WhatsApp
        </button>
      </div>
    </div>
  </div>

<script>
const vendorName = '<%= vendor.store_name %>';
const vendorWhatsApp = '<%= vendor.whatsapp || "" %>';
let cart = JSON.parse(localStorage.getItem('cart_' + vendorName) || '[]');

function updateCartUI() {
  const cartCount = document.getElementById('cartCount');
  const cartItems = document.getElementById('cartItems');
  const cartTotal = document.getElementById('cartTotal');
  const checkoutBtn = document.getElementById('checkoutBtn');

  const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
  const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);

  cartCount.textContent = totalItems;
  cartCount.classList.add('cart-count');
  setTimeout(() => cartCount.classList.remove('cart-count'), 300);

  if (cart.length === 0) {
    cartItems.innerHTML = '<p class="text-gray-500 text-center">Your cart is empty</p>';
    checkoutBtn.disabled = true;
  } else {
    cartItems.innerHTML = cart.map(item => `
      <div class="flex items-center gap-4 mb-4 pb-4 border-b">
        <div class="flex-1">
          <h4 class="font-semibold text-gray-800">${item.name}</h4>
          <p class="text-green-600 font-bold">â‚µ${item.price}</p>
        </div>
        <div class="flex items-center gap-2">
          <button onclick="updateQuantity('${item.id}', -1)" class="w-8 h-8 bg-gray-200 rounded-full hover:bg-gray-300">-</button>
          <span class="font-semibold w-8 text-center">${item.quantity}</span>
          <button onclick="updateQuantity('${item.id}', 1)" class="w-8 h-8 bg-blue-500 text-white rounded-full hover:bg-blue-600">+</button>
        </div>
        <button onclick="removeFromCart('${item.id}')" class="text-red-500 hover:text-red-700">âœ–</button>
      </div>
    `).join('');
    checkoutBtn.disabled = false;
  }

  cartTotal.textContent = 'â‚µ' + total.toFixed(2);
}

function addToCart(id, name, price) {
  const existing = cart.find(item => item.id === id);
  if (existing) existing.quantity++;
  else cart.push({id, name, price, quantity:1});
  localStorage.setItem('cart_' + vendorName, JSON.stringify(cart));
  updateCartUI();
}

function updateQuantity(id, change) {
  const item = cart.find(item => item.id === id);
  if (item) {
    item.quantity += change;
    if (item.quantity <= 0) removeFromCart(id);
    else {
      localStorage.setItem('cart_' + vendorName, JSON.stringify(cart));
      updateCartUI();
    }
  }
}

function removeFromCart(id) {
  cart = cart.filter(item => item.id !== id);
  localStorage.setItem('cart_' + vendorName, JSON.stringify(cart));
  updateCartUI();
}

function toggleCart() {
  document.getElementById('cartSidebar').classList.toggle('translate-x-full');
}

function checkoutWhatsApp() {
  if (!vendorWhatsApp) return alert('WhatsApp contact not available for this vendor');
  if (cart.length === 0) return alert('Cart is empty');

  let message = `Hi ${vendorName}, I would like to order:\n\n`;
  cart.forEach(item => message += `${item.quantity} x ${item.name} - â‚µ${(item.price*item.quantity).toFixed(2)}\n`);
  const total = cart.reduce((sum, item) => sum + (item.price*item.quantity), 0);
  message += `\nTotal: â‚µ${total.toFixed(2)}`;

  window.open(`https://wa.me/${vendorWhatsApp.replace(/[^0-9]/g,'')}?text=${encodeURIComponent(message)}`, '_blank');

  cart = [];
  localStorage.setItem('cart_' + vendorName, JSON.stringify(cart));
  updateCartUI();
}

updateCartUI();
</script>
</body>
</html>