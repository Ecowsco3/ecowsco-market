<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title><%= vendor.store_name %> - Ecowsco Market</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
  .cart-count {
    animation: bounce 0.3s ease;
  }
  @keyframes bounce {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.2); }
  }
</style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen pb-20">
  <div class="bg-white shadow-md mb-8">
    <div class="max-w-7xl mx-auto px-6 py-6 flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold text-gray-800"><%= vendor.store_name %></h1>
        <p class="text-gray-600 mt-1"><%= vendor.description || 'Welcome to our store' %></p>
      </div>
      <% if(vendor.whatsapp){ %>
        <a href="<%= vendor.whatsapp %>" target="_blank" 
           class="inline-flex items-center gap-2 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-5 py-3 rounded-lg hover:from-green-600 hover:to-emerald-700 transition font-semibold shadow-lg">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24">
            <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
          </svg>
          Contact on WhatsApp
        </a>
      <% } %>
    </div>
  </div>

  <div class="max-w-7xl mx-auto px-6 pb-8">
    <% if(products.length === 0){ %>
      <div class="bg-white rounded-2xl shadow-xl p-12 text-center">
        <svg class="w-16 h-16 mx-auto text-gray-300 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
        </svg>
        <p class="text-gray-500 text-lg">No products available at the moment</p>
      </div>
    <% }else{ %>
      <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <% products.forEach(p=>{ %>
          <div class="bg-white rounded-xl shadow-lg hover:shadow-2xl transition overflow-hidden">
            <div class="relative h-56">
              <img src="<%= p.image %>" alt="<%= p.name %>" class="w-full h-full object-cover">
            </div>
            <div class="p-5">
              <h3 class="font-bold text-xl text-gray-800 mb-2"><%= p.name %></h3>
              <p class="text-3xl font-bold text-green-600 mb-3">₵<%= p.price %></p>
              <p class="text-sm text-gray-600 mb-4"><%= p.description || 'No description available' %></p>
              <button onclick="addToCart('<%= p.id %>', '<%= p.name %>', <%= p.price %>)" 
                      class="w-full bg-gradient-to-r from-blue-500 to-blue-600 text-white px-4 py-3 rounded-lg hover:from-blue-600 hover:to-blue-700 transition font-semibold shadow-lg">
                Add to Cart
              </button>
            </div>
          </div>
        <% }) %>
      </div>
    <% } %>
  </div>

  <!-- Floating Cart Button -->
  <div id="cartButton" class="fixed bottom-6 right-6 z-50">
    <button onclick="toggleCart()" class="relative bg-gradient-to-r from-green-500 to-emerald-600 text-white p-4 rounded-full shadow-2xl hover:from-green-600 hover:to-emerald-700 transition">
      <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"></path>
      </svg>
      <span id="cartCount" class="absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center cart-count">0</span>
    </button>
  </div>

  <!-- Cart Sidebar -->
  <div id="cartSidebar" class="fixed top-0 right-0 h-full w-full md:w-96 bg-white shadow-2xl transform translate-x-full transition-transform duration-300 z-50">
    <div class="h-full flex flex-col">
      <div class="p-6 border-b flex justify-between items-center bg-gradient-to-r from-blue-500 to-blue-600 text-white">
        <h3 class="text-2xl font-bold">Your Cart</h3>
        <button onclick="toggleCart()" class="text-white hover:text-gray-200">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      
      <div id="cartItems" class="flex-1 overflow-y-auto p-6">
        <p class="text-gray-500 text-center">Your cart is empty</p>
      </div>
      
      <div class="p-6 border-t bg-gray-50">
        <div class="mb-4">
          <div class="flex justify-between text-lg font-semibold">
            <span>Total:</span>
            <span id="cartTotal" class="text-green-600">₵0.00</span>
          </div>
        </div>
        <button onclick="checkoutWhatsApp()" id="checkoutBtn" disabled
                class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-4 rounded-lg font-bold hover:from-green-600 hover:to-emerald-700 transition shadow-lg disabled:opacity-50 disabled:cursor-not-allowed">
          Checkout via WhatsApp
        </button>
      </div>
    </div>
  </div>

  <script>
    const vendorName = '<%= vendor.store_name %>';
    const vendorWhatsApp = '<%= vendor.whatsapp || "" %>';
    let cart = JSON.parse(localStorage.getItem('cart_' + vendorName) || '[]');

    function updateCartUI() {
      const cartCount = document.getElementById('cartCount');
      const cartItems = document.getElementById('cartItems');
      const cartTotal = document.getElementById('cartTotal');
      const checkoutBtn = document.getElementById('checkoutBtn');
      
      const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      
      cartCount.textContent = totalItems;
      cartCount.classList.add('cart-count');
      setTimeout(() => cartCount.classList.remove('cart-count'), 300);
      
      if (cart.length === 0) {
        cartItems.innerHTML = '<p class="text-gray-500 text-center">Your cart is empty</p>';
        checkoutBtn.disabled = true;
      } else {
        cartItems.innerHTML = cart.map(item => `
          <div class="flex items-center gap-4 mb-4 pb-4 border-b">
            <div class="flex-1">
              <h4 class="font-semibold text-gray-800">${item.name}</h4>
              <p class="text-green-600 font-bold">₵${item.price}</p>
            </div>
            <div class="flex items-center gap-2">
              <button onclick="updateQuantity('${item.id}', -1)" class="w-8 h-8 bg-gray-200 rounded-full hover:bg-gray-300">-</button>
              <span class="font-semibold w-8 text-center">${item.quantity}</span>
              <button onclick="updateQuantity('${item.id}', 1)" class="w-8 h-8 bg-blue-500 text-white rounded-full hover:bg-blue-600">+</button>
            </div>
            <button onclick="removeFromCart('${item.id}')" class="text-red-500 hover:text-red-700">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
              </svg>
            </button>
          </div>
        `).join('');
        checkoutBtn.disabled = false;
      }
      
      cartTotal.textContent = '₵' + total.toFixed(2);
    }

    function addToCart(id, name, price) {
      const existingItem = cart.find(item => item.id === id);
      if (existingItem) {
        existingItem.quantity++;
      } else {
        cart.push({ id, name, price, quantity: 1 });
      }
      localStorage.setItem('cart_' + vendorName, JSON.stringify(cart));
      updateCartUI();
      toggleCart();
    }

    function updateQuantity(id, change) {
      const item = cart.find(item => item.id === id);
      if (item) {
        item.quantity += change;
        if (item.quantity <= 0) {
          removeFromCart(id);
        } else {
          localStorage.setItem('cart_' + vendorName, JSON.stringify(cart));
          updateCartUI();
        }
      }
    }

    function removeFromCart(id) {
      cart = cart.filter(item => item.id !== id);
      localStorage.setItem('cart_' + vendorName, JSON.stringify(cart));
      updateCartUI();
    }

    function toggleCart() {
      const sidebar = document.getElementById('cartSidebar');
      sidebar.classList.toggle('translate-x-full');
    }

    function checkoutWhatsApp() {
      if (!vendorWhatsApp) {
        alert('WhatsApp contact not available for this vendor');
        return;
      }
      
      let message = `Hi ${vendorName}! I would like to order:\\n\\n`;
      cart.forEach(item => {
        message += `${item.quantity}x ${item.name} - ₵${(item.price * item.quantity).toFixed(2)}\\n`;
      });
      const total = cart.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      message += `\\nTotal: ₵${total.toFixed(2)}`;
      
      const whatsappUrl = `https://wa.me/${vendorWhatsApp.replace(/[^0-9]/g, '')}?text=${encodeURIComponent(message)}`;
      window.open(whatsappUrl, '_blank');
    }

    updateCartUI();
  </script>
</body>
</html>